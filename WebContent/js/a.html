<!DOCTYPE HTML>
<html>
<head>
<script>






 
  
//셀렉션 함수 
document.getSelection2 = function(evt, document) { 
  
    var result = { 
        text : "", 
        st : -1, 
        ed : -1 
    }; 
  
    if (document.getSelection) { //FF, Chrome 
  
        var selection = document.getSelection(); 
        var startOffset = -1; 
        var previousSibling = null; 
        if ( selection.anchorOffset >= selection.focusOffset ) { 
            startOffset = selection.focusOffset; 
            previousSibling = selection.focusNode.previousSibling; 
        } else { 
            startOffset = selection.anchorOffset; 
            previousSibling = selection.anchorNode.previousSibling; 
        } 
  
        while( previousSibling != null ) { 
            var node = previousSibling; 
            if ( node.nodeType == 3 ) { 
                startOffset += node.data.length; 
            } else { 
                startOffset += node.find(".dragtag").text().length; 
            } 
            previousSibling = node.previousSibling; 
        } 
  
        result.text = node.trim(selection.toString()); 
        result.st = startOffset + (selection.toString().length - selection.toString().replace(/^\s*/,'').length); 
        result.ed = startOffset + selection.toString().replace(/\s*$/, '').length; 
  
    } else if (document.selection) { //IE 
  
        var selection = document.selection.createRange(); 
        var selection2 = document.selection.createRange(); 
        selection2.moveToElementText(selection.parentElement()); 
        selection2.setEndPoint('EndToStart', selection); 
        result.text = $.trim(selection.text); 
        result.st = selection2.text.length + (selection.text.length - selection.text.replace(/^\s*/,'').length); 
        result.ed = selection2.text.length + selection.text.replace(/\s*$/, '').length; 
  
    } 
  
    return result; 
};
function allowDrop(ev)
{
ev.preventDefault();
}

function drag(ev)
{
ev.dataTransfer.setData("Text",ev.target.id);
}

function dropa(ev)
{
ev.preventDefault();
var data = ev.dataTransfer.getData("Text");
alert(data);
//ev.target.appendChild(document.getElementById(data));
}



</script>
</head>
<body onLoad="on();">
<div id="drags" draggable="true">okokokOKOK</div>
<div id="drags2" draggable="true">NoNoNoNo</div>
adsfasdfasdfasdf
asdfasdf
asdf
<br>
adsfasdfa
<br>
adfadsfsdㅁㅁㅁㅁ
<br>
<img id="drag1" src="http://cfile25.uf.tistory.com/image/167A813D4ED44F211FEC86" draggable="true" width="336" height="336">



<iframe  id="naver" src="http://www.naver.com" width="700" height="800" scrolling="auto"> </iframe>

<iframe id="test" src="b.html" width="700" height="800" scrolling="auto" draggable="true" > </iframe>
<div contentEditable="true" id="edit"> Type here. You can insert images too </div>

<script>

document.getElementById("drags").addEventListener("dragstart",drag,false);
document.getElementById("drags2").addEventListener("dragenter",function(evt){
alert("aaaa");
},false);
document.getElementById("drags2").addEventListener("drop",dropa,false);

function on(){
//처리 이벤트 
//var a =document.getElementById("naver").contentWindow;
var a =document.getElementById("test").contentWindow;
var b;
//alert(document.getElementById("test").contentWindow.document.getElementById("drag1").src);

//document.domain = a.document.domain;

a.document.onmouseup= function( evt ){ 
//document.onmouseup= function( evt ){ 

    alert( getSelectionHtml(a) ); 
}; 

}
var cc =  document.getElementById("drags2");
cc;
var dd =  document.getElementById("drags");
cc;
function getSelectionHtml(s) {

    var html = "";
    if (typeof s.window.getSelection != "undefined") {

        var sel = s.window.getSelection();
        if (sel.rangeCount) {
            var container = s.document.createElement("div");
            for (var i = 0, len = sel.rangeCount; i < len; ++i) {
                container.appendChild(sel.getRangeAt(i).cloneContents());
            }
            html = container.innerHTML;
        }
    } else if (typeof s.document.selection != "undefined") {
	
        if (s.document.selection.type == "Text") {
            html = s.document.selection.createRange().htmlText;
        }
    }
    return html;
}

var b;

document.addEventListener('paste', function(event){
	alert(event.clipboardData.getData('text/plain'));
	document.getElementById("edit").value = event.clipboardData;
},false);

</script>


</body>
</html>