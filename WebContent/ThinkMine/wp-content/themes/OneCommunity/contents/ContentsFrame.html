
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>	
	<script>
		if(!window.ContentsModule)
			ContentsModule = {};
		if(!ContentsModule.Interface)
			ContentsModule.Interface = {};
			
		function addJavascript(jsname) {
			var th = document.getElementsByTagName('head')[0];
			var s = document.createElement('script');
			s.setAttribute('type','text/javascript');
			s.setAttribute('src',jsname);
			th.appendChild(s);
		}

		addJavascript("/Common/Constants/ContentsConstants.js");
		addJavascript("/Common/Constants/ThinkMineConstants.js");
		addJavascript("ContentsFrameConstants.js");
		addJavascript("GridGen.js");
		addJavascript("AdaptiveVideoPlayer/js/AdaptiveVideoPlayer.js");
		addJavascript("/thirdparty/JavaScript-ID3-Reader/dist/id3-minimized.js");		
		
		var imgFileList;
		var imgCurrentPage = 0;
		
		var mainVDPlayer
		var popupVDPlayer;
		
	</script>
	<style type='text/css'>
	body {
	  font-family: sans-serif;
	}
	.wrapper {
	  background: #D6E6F5;

	}
	h1 {
	  text-align: center;
	}
	div.tabs {
	  list-style-type: none;
	  margin: 0;
	  padding: 0;
	}
	div.tabs div {
	  border-bottom: none;
	  margin: 0 .25em 0 0;
	  padding: .25em .5em;
	}
	div.tabs div a {
	  color: gray;
	  font-weight: bold;
	  text-decoration: none;
	}
	div.tabs div.active {
	  background: #9fcaf2;
	}
	div.tabs div.active a {
	  color: white;
	}
	.clr {
	  clear: both;
	}
	article {
	  border-top: gray solid 1px;
	  padding: 0 1em;
	}	
	.text {
		width:500px;
		overflow:hidden;
		background-color:#D6E6F5;
		color:#222;
		font-family:Courier, monospace;
		font-weight:normal;
		font-size:12px;
		resize:none;
		outline:none;		
	}
	.empty_text {		
		outline:none;
		text-overflow: ellipsis;
		background-color:#D6E6F5;
		border:none;
		margin:0px;
		padding:0px;		
		color:#000;
		font-size:13px;
		font-family:Courier, monospace;
		height:28px;
		font-weight:bold;
		width:600px;
	}
	.vdModalDialog {		
		font-family: Arial, Helvetica, sans-serif;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
		background: rgba(0,0,0,0.0);		
	}


	.vdModalDialog > div {
		position: absolute;
		margin: 10% auto;
		padding: 5px 20px 13px 20px;
		border-radius: 10px;
		background: #fff;
		background: -moz-linear-gradient(#fff, #fff);
		background: -webkit-linear-gradient(#fff, #fff);
		background: -o-linear-gradient(#fff, #fff);
	}
	.vdModalDialogClose{
		background: #606061;
		color: #FFFFFF;
		line-height: 25px;
		position: absolute;
		right: -12px;
		text-align: center;
		top: -10px;
		width: 24px;
		text-decoration: none;
		font-weight: bold;
		-webkit-border-radius: 12px;
		-moz-border-radius: 12px;
		border-radius: 12px;
		-moz-box-shadow: 1px 1px 3px #000;
		-webkit-box-shadow: 1px 1px 3px #000;
		box-shadow: 1px 1px 3px #000;
	}

	.vdModalDialogClose:hover { background: #9fcaf2; }
	
	.divTextOverFlowHide{
		overflow : hidden; 
		text-overflow: ellipsis; 	
		max-width: 100px;
		display: block;
		white-space: nowrap;
	}

	
	</style>
</head>
<body>	
	<div id="textShowingDiv" style="display:none; position:absolute; background: #ffffff;"></div>
	<link type="text/css" rel="stylesheet" href="../css/toolbar-anim.css"/>	
	<link type="text/css" rel="stylesheet" href="/thirdparty/circle-preloader/css/reset.css"/>	
	<link type="text/css" rel="stylesheet" href="/thirdparty/circle-preloader/css/style.css"/>	
	<form onmousedown="stopPropagationFunc(event);"
			onmousemove="stopPropagationFunc(event);"
			ontouchstart="stopPropagationFunc(event);"
			ontouchmove="stopPropagationFunc(event);" 
			id="fileUploadForm" method="post" enctype="multipart/form-data" onsubmit="on_fileupload(this)" target="dummyFrame" style="display:none">
		<input type="hidden" id="ui_val" name="UI" value=""/>
		<input type="hidden" id="ct_val" name="CT" value=""/>		
		<div id="changableFileInput"><input type="file" name="contentsFile" onchange="handleFiles(this.files)" /></div>
		<input type="submit" id="btn_upload"/>		
		<iframe name="dummyFrame" style="display:none"></iframe>
	</form>
	<form onmousedown="stopPropagationFunc(event);"
			onmousemove="stopPropagationFunc(event);"
			ontouchstart="stopPropagationFunc(event);"
			ontouchmove="stopPropagationFunc(event);" 			
			method="post" id="form_contents_list_req">
		<input type="hidden" id="req_list_ui_val" name="UI" value=""/>
		<input type="hidden" id="req_list_ct_val" name="CT" value=""/>		
	</form>
	<input type="submit" name="btn_req_file_list"  onclick="on_reqImgFileList()"/>
	<div style='display:flex; display:-webkit-flex;'>
		<section class="wrapper">
			<div class="tabs" height='200' width='50'>
				<div id="div_textcontents" width='50' height='50'><a><img src="/ThinkMineCV/res/TextContents.png" width='50' height='50' /></a></div>
				<div id="div_imagecontents" width='50' height='50'><a><img src="/ThinkMineCV/res/ImageContents.jpg" width='50' height='50' /></a></div>
				<div id="div_moviecontents" width='50' height='50'><a><img src="/ThinkMineCV/res/MovieContents.png" width='50' height='50' /></a></div>
				<div id="div_soundcontents" width='50' height='50'><a><img src="/ThinkMineCV/res/SoundContents.png" width='50' height='50' /></a></div>
				<div id="div_webcontents" width='50' height='50'><a><img src="/ThinkMineCV/res/WebPreviewContents.png" width='50' height='50' /></a></div>
			</div>				
		</section>
		<section class="block" height='1000' style="clear:left">					
			<div id="TextContentsManager">
				<div id="margin">Title: <input id="TextTitle" type="text" class="empty_text"></div>
				<textarea placeholder="Any Text" id="TextValue" class="text" name="text" rows="4" style="overflow: hidden; word-wrap: break-word; resize: none; height: 160px; "></textarea>  
			</div>
			<div id="ImageContentsManager">				
				<div class="fixedDiv" style="position:absolute;">										
					<input placeholder="Image URL" class="empty_text" type="text" id="ImageURL" onchange="loadImageUrlOn(this)">
					<div class="ImageSelector" style="width:600px;height:357.5px;background-color:#D6E6F5;">
						<img id="ThumbNailImg" width='600px' height='347.5px' style="position:absolute;"> </img>			
						<div id="ThumbNailUploadProgress" style="position:absolute;"></div>							
					</div>
					<textarea placeholder="Image Explanation" class="empty_text" id="imgText" name="text" rows="4" style="overflow: hidden; word-wrap: break-word; resize: none; height: 40px; width : 100%;"></textarea>  					
				</div>
				<div class="dummyDiv" style="overflow: hidden; word-wrap: break-word; resize: none; height:432.5px">				
				</div>
				<div class="layout" style="border:1px solid #FFFFFF; height:370px; width:600px">					
					<div id="storedImgs" height='auto'></div>							
				</div>
			</div>
			<div id="MovieContentsManager">
				<div class="fixedDiv" style="position:absolute;">										
					<input placeholder="Video URL" class="empty_text" type="text" id="VideoURL" onchange="loadVDUrlOn(this)">
					<div class="VideoSelector" style="width:600px;height:347.5px;background-color:#D6E6F5;">
						<div id="mainVideoObj" width='150px' height='150px' style="position:absolute;"> </div>			
						<div id="VideoUploadProgress" style="position:absolute;"></div>							
					</div>
					<textarea placeholder="Video Explanation" class="empty_text" id="mvText" name="text" rows="4" style="overflow: hidden; word-wrap: break-word; resize: none; height: 40px; width : 100%;"></textarea>  					
				</div>
				<div id="openVDModal" class="vdModalDialog fadeout_anim" onmousedown="window.location='#close';" ontouchstart="window.location='#close';">
					<div style="z-index:9999;">
						<div title="Close" class="vdModalDialogClose" ontouchstart="videoPopUpShadow(this)" onclick="videoPopUpShadow(this)">X</div>
						<h2 id="vdName"></h2>
						<div id="popupVideoObj">

						</div>
					</div>
				</div>
				<div class="dummyDiv" style="overflow: hidden; word-wrap: break-word; resize: none; height:432.5px">				
				</div>
				<div class="layout" style="border:1px solid #FFFFFF; height:370px; width:600px">					
					<div id="storedVds" height='auto'></div>							
				</div>
			</div>
			<div id="SoundContentsManager">
				<div class="fixedDiv" style="position:absolute;">										
					<input placeholder="Sound URL" class="empty_text" type="text" id="SoundURL" onchange="loadSNDUrlOn(this)">
					<div class="SoundSelector" style="width:600px;height:347.5px;background-color:#D6E6F5;">						
						<img id="soundPictureObj" width='600px' height='300px' style="position:absolute;" ontouchstart='playOrStopAudio(this)' onclick='playOrStopAudio(this)'> </img>			
						<audio id="mainSoundObj" width='600px' height='47.5px'  style="position:absolute;" controls="controls"> </audio>	
						<div id="SoundUploadProgress" style="position:absolute;"></div>							
					</div>					
					<textarea placeholder="Sound Explanation" class="empty_text" id="sndText" name="text" rows="4" style="overflow: hidden; word-wrap: break-word; resize: none; height: 40px; width : 100%;"></textarea>  					
				</div>				
				<div class="dummyDiv" style="overflow: hidden; word-wrap: break-word; resize: none; height:432.5px">				
				</div>
				<div class="layout" style="border:1px solid #FFFFFF; height:370px; width:600px">					
					<div id="storedSnds" height='auto'></div>							
				</div>
			</div>
			<div id="WebContentsManager">
				<div class="fixedDiv" style="position:absolute;">										
					<input placeholder="Web URL" class="empty_text" type="text" id="WebURL" onchange="loadWebUrlOn(this)">
					<div class="WebSelector" style="width:600px;height:717.5px;background-color:#D6E6F5;">		
						<div id='WebPreviewContainer' style='  position:relative;overflow-y:scroll; overflow-x:hidden;  width:600px; height:717.5px;'> 
						</div>
					</div>				
					<textarea placeholder="Web Explanation" class="empty_text" id="sndText" name="text" rows="4" style="overflow: hidden; word-wrap: break-word; resize: none; height: 40px; width : 100%;"></textarea>				
				</div>				

			</div>
		</section>
	</div>
	<script>
		var stopPropagationFunc = function(event){event.stopPropagation();};		
		var gridGenerator = null;

		
		window.onload = function(){
			$(function(){
				$('div.tabs div:first').addClass('active');
				$('.block div').hide();
				$('.block div:first').show();
				$('.block div:first').find('*').show();
				var innerDivs = $('.tabs').find('a');
				var contentsKeys = Object.keys(CONTENTS_TYPE_ENUM);
				for(var i=0; i<innerDivs.length; i++)
					innerDivs[i].setAttribute("href","#"+CONTENTS_TYPE_ENUM[contentsKeys[i]]);	
				innerDivs = $('section.block > div');
				for(var i=0; i<innerDivs.length; i++)
					innerDivs[i].setAttribute("id",CONTENTS_TYPE_ENUM[contentsKeys[i]]);	
				$('div.tabs div').on('click',function(){
					$('div.tabs div').removeClass('active');
					$(this).addClass('active')
					$('.block div').hide();
					var activeTab = $(this).find('a').attr('href');
					$(activeTab).show();
					$(activeTab).find('*').show();
					
					var reqContentsType = $(this).find('a').attr('href').substring(1);
					ContentsModule.Interface.notifyContentsType(reqContentsType);					
					return false;
				});
			})
			ContentsModule.Interface = new function(undefined){
				this.Val_UI = "NA";
				this.Val_CT = CONTENTS_TYPE_ENUM.Image;
				var isLogOn = false;
				
				this.notifyLogInStatus = function(userId,argIsLogOn){
					this.Val_UI = userId;
					isLogOn = argIsLogOn;
				};
				
				this.notifyContentsType = function(contentsType){
					this.Val_CT = contentsType;		
				};
				this.getLogInStatus = function(){
					return isLogOn;
				};
			};		
			
			ContentsModule.Interface.notifyLogInStatus("jdj9354",true);		

			if(parent.ThinkMine){			
				parent.ThinkMine.Lib.ExternalUI.TextContentsImageButton.attach("div_textcontents",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.ImageContentsImageButton.attach("div_imagecontents",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.MovieContentsImageButton.attach("div_moviecontents",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.SoundContentsImageButton.attach("div_soundcontents",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.WebPreviewContentsImageButton.attach("div_webcontents",parent.TmCanvas);
				
				parent.ThinkMine.Lib.ExternalUI.TextContentsValueInput.attach("TextValue",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.ImageContentsValueInput.attach("ImageURL",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.MovieContentsValueInput.attach("VideoURL",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.SoundContentsValueInput.attach("SoundURL",parent.TmCanvas);
				parent.ThinkMine.Lib.ExternalUI.WebPreviewContentsValueInput.attach("WebURL",parent.TmCanvas);
			}			
			
			gridGenerator = new GridPageGenerator(null,null);
			
			AdaptiveVideoPlayer.init();
			var mainVDObj = document.getElementById('mainVideoObj');
			mainVDPlayer = new AdaptiveVideoPlayer.player(mainVDObj,"");
			mainVDPlayer.setPlayerHeight(CONTENTS_RECEIVER_MAX_HEIGHT_PX);
			mainVDPlayer.setPlayerWidth(CONTENTS_RECEIVER_MAX_WIDTH_PX);
			mainVDObj.adaptiveVdObj = mainVDPlayer;			
			popupVDPlayer = new AdaptiveVideoPlayer.player(document.getElementById('popupVideoObj'),"");
			
		};
		function on_reqImgFileList(){
			var url = "http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_PORT+"/list";
			var params = "CT="+ContentsModule.Interface.Val_CT+"&UI="+ContentsModule.Interface.Val_UI;	
			var data = { CT : ContentsModule.Interface.Val_CT,
						 UI : ContentsModule.Interface.Val_UI
						};			
			$.post(url,data, function(response){					
				var resObj = JSON.parse(response);
				var CF = resObj.CF;
				var UF  = resObj.UF;
				var CT = resObj.CT;
				contentsFileList = resObj.FL;
				
				var containerObj;
				var templateArr = [];
				
				switch(CT){
				case CONTENTS_TYPE_ENUM["Text"] :
					break;
				case CONTENTS_TYPE_ENUM["Image"] :
					containerObj = $('#storedImgs');
					for(var i=0; i<contentsFileList.length; i++){
						var template = "<img id=img"+i+" src='http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_FILE_ACCESS_PORT+"/"+UF+"/"+CF+"/"+contentsFileList[i]+"' width='110px' height='110px'>"
										+"<br>"
										+"<div onmouseenter='onShowTextExtend(event);' onmousemove='onMoveTextExtend(event);' onmouseout='onHideTextExtend(event);' class='divTextOverFlowHide'>" + contentsFileList[i] + "</div>";
						templateArr.push(template);
					}
					break;
				case CONTENTS_TYPE_ENUM["Movie"] :
					containerObj = $('#storedVds');
					for(var i=0; i<contentsFileList.length; i++){
						var template = "<video id=vd"+i+" src='http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_FILE_ACCESS_PORT+"/"+UF+"/"+CF+"/"+contentsFileList[i]+"' width='110px' height='110px' ontouchstart='videoPopUp(this)' onclick='videoPopUp(this)' draggable='true' ondragstart='onVideoDragStart(event)'></video>"
										+"<br>"
										+"<div onmouseenter='onShowTextExtend(event);' onmousemove='onMoveTextExtend(event);' onmouseout='onHideTextExtend(event);' class='divTextOverFlowHide'>" + contentsFileList[i] + "</div>";
						templateArr.push(template);
					}
					break;
				case CONTENTS_TYPE_ENUM["Sound"] :
					containerObj = $('#storedSnds');
					for(var i=0; i<contentsFileList.length; i++){
						var template = "<img ondragstart='setSndDragData(event);' id=id3picture"+i+" width='110px' height='110px' ontouchstart='playOrStopAudio(this)' onclick='playOrStopAudio(this)' draggable='true'>"
										+"<br>"
										+"<audio id=ad"+i+" src='http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_FILE_ACCESS_PORT+"/"+UF+"/"+CF+"/"+contentsFileList[i]+"' width='110px' height='25px'></audio>"					
										+"<div onmouseenter='onShowTextExtend(event);' onmousemove='onMoveTextExtend(event);' onmouseout='onHideTextExtend(event);' class='divTextOverFlowHide'>" + contentsFileList[i] + "</div>";
						templateArr.push(template);
					}
					break;
				case CONTENTS_TYPE_ENUM["WebPreview"] :
					return;
					/*
					containerObj = $('#visitedWebs');
					contentsFileList = [];
					
					for(var i=0; i<10; i++){
						contentsFileList[i] = "http://www.github.com";
					}
					
					for(var i=0; i<contentsFileList.length; i++){
						var template =  "<div style='display:flex;'>"
										+"<img src='http://www.google.com/s2/favicons?domain=" +contentsFileList[i]+"' ondragstart='setSndDragData(event);' id=webFavicon"+i+" width='16px' height='16px' ontouchstart='playOrStopAudio(this)' onclick='playOrStopAudio(this)' draggable='true'>"											
										+"<div onmouseenter='onShowTextExtend(event);' onmousemove='onMoveTextExtend(event);' onmouseout='onHideTextExtend(event);' class='divTextOverFlowHide'>" + contentsFileList[i] + "</div>"
										+"</div>";
						templateArr.push(template);
					}*/
					break;
				}
				
				while (containerObj[0].firstChild) {
					containerObj[0].removeChild(containerObj[0].firstChild);
				}												

				gridGenerator.onPageChanged = function(pageNum){
					gridGenerator.getTargetDivElement().parentElement.parentElement.scrollTop = 0;		
					if(CT == CONTENTS_TYPE_ENUM["Sound"]){
						var numCol = gridGenerator.getMaxCol();
						var numRow = gridGenerator.getMaxRow();
						var startIdx = (pageNum-1)*numCol*numRow;
						
						var elemIdx = startIdx;
						var curPictureElement = document.getElementById("id3picture"+elemIdx);
						var curAudioElement = document.getElementById("ad"+elemIdx);
						curAudioElement.style.height='0px';

						var recursiveCallback = function() {

							var tags = ID3.getAllTags(curAudioElement.src);															
							var image = tags.picture;
							if (image) {
								var base64String = "";
								for (var i = 0; i < image.data.length; i++) {
									base64String += String.fromCharCode(image.data[i]);
								}
								var base64 = "data:" + image.format + ";base64," +
									window.btoa(base64String);
									curPictureElement.setAttribute('src',base64);
									
								elemIdx++;
								curPictureElement = document.getElementById("id3picture"+elemIdx);
								curAudioElement = document.getElementById("ad"+elemIdx);
								
								if(curPictureElement == null)
									return;
								else
									ID3.loadTags(curAudioElement.src, recursiveCallback,{tags: ["title","artist","album","picture"]});
							} 
							else {
								curPictureElement.style.display = "none";
							}
						};
						
						ID3.loadTags(curAudioElement.src, recursiveCallback,{tags: ["title","artist","album","picture"]});
						
						/*for (var i = startIdx; i < startIdx+numCol*numRow; i++) {							
							var curPictureElement = document.getElementById("id3picture"+i);
							if(curPictureElement == null)
								break;
							var curAudioElement = document.getElementById("ad"+i);
							
							var result = ID3.loadTags(curAudioElement.src, function() {
								var tags = ID3.getAllTags(curAudioElement.src);								
								
								var image = tags.picture;
								if (image) {
									var base64String = "";
									for (var i = 0; i < image.data.length; i++) {
										base64String += String.fromCharCode(image.data[i]);
									}
									var base64 = "data:" + image.format + ";base64," +
										window.btoa(base64String);
										curPictureElement.setAttribute('src',base64);
								} 
								else {
									curPictureElement.style.display = "none";
								}
							});
						}*/
					}
				};

				gridGenerator.setTargetDivElement(containerObj[0]);			
				gridGenerator.setItemTemplateArr(templateArr);
				
				gridGenerator.generate();
				containerObj.parent().parent().scrollTop(0);																				
			});
		}
		function handleFiles(files){				
			var imageThumbNailObj = document.getElementById('ThumbNailImg');
			setImgSrcAndAdjust(imageThumbNailObj,window.URL.createObjectURL(files[0]),CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);			
			fileUploadHandler(files);				
			event.preventDefault && event.preventDefault();
			return false;				
		}
		var curThumbNailImgObj = document.getElementById('ThumbNailImg');
		curThumbNailImgObj.onclick = function () { 
			var event = new Event('click');				
			var fileInputBtn = document.getElementsByName('contentsFile');				
			fileInputBtn[0].dispatchEvent(event);
			return false; 
		};
		curThumbNailImgObj.ontouch = function () { this.className = 'hover'; return false; };
		curThumbNailImgObj.ondragover = function () { this.className = 'hover'; return false; };
		curThumbNailImgObj.ondragend = function () { this.className = ''; return false; };
		curThumbNailImgObj.ondrop = function (event) {
			if(event.dataTransfer.files.length != 0){
				var files = event.dataTransfer.files;
				var updateElementInfo = {mainElemId : "ThumbNailImg",
										urlElemId : "ImageURL",
										progressElemId : "ThumbNailUploadProgress"
										}	
				console.log(files);
				setImgSrcAndAdjust(this,window.URL.createObjectURL(files[0]),CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);			
				fileUploadHandler(files,updateElementInfo);				
			}
			else{				
				if(event.dataTransfer.items){				
					if(event.dataTransfer.items.length != 0){
						var imgObj = this;
						var inspectItem = event.dataTransfer.items[0];
						for(var i=0; i<event.dataTransfer.items.length; i++){
							if(event.dataTransfer.items[i].type == 'text/html'){
								inspectItem = event.dataTransfer.items[i];
								break;
							}
						}				
						inspectItem.getAsString(function(res){
							try{
								res = res.slice(res.indexOf("<img"));	
								res = res.slice(res.indexOf("src"));
								res = res.slice(res.indexOf("\"")+1);
								res = res.substr(0,res.indexOf("\""));
								setImgSrcAndAdjust(imgObj,res,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);						
								//fileUploadHandler(files);
								document.getElementById('ImageURL').value=res;
							}
							catch (e){
								return;
							}
						});				
					}
				}
			}
			event.preventDefault && event.preventDefault();
			
			return false;
		};
		
		
		
		var videoObj = document.getElementById('mainVideoObj');
		/*videoObj.onclick = function () { 
			var event = new Event('click');				
			var fileInputBtn = document.getElementsByName('contentsFile');				
			fileInputBtn[0].dispatchEvent(event);
			return false; 
		};*/
		videoObj.ontouch = function () { this.className = 'hover'; return false; };
		videoObj.ondragover = function () { this.className = 'hover'; return false; };
		videoObj.ondragend = function () { this.className = ''; return false; };
		videoObj.ondrop = function (event) {
			if(!this.isClickable && this.isClickable != undefined)
				return;
			var srcFromVDList = event.dataTransfer.getData("srcFromVDList");
			if(srcFromVDList != null && srcFromVDList != undefined && srcFromVDList != ""){
				setVDSrcAndAdjust(this,srcFromVDList,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
				document.getElementById('VideoURL').value=srcFromVDList;
				return;
			}
			if(event.dataTransfer.files.length != 0){
				var files = event.dataTransfer.files;
				var updateElementInfo = {mainElemId : "mainVideoObj",
										urlElemId : "VideoURL",
										progressElemId : "VideoUploadProgress"
										}
				console.log(files);
				setVDSrcAndAdjust(this,window.URL.createObjectURL(files[0]),CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);			
				fileUploadHandler(files,updateElementInfo);				
			}
			else{
				if(event.dataTransfer.items){				
					if(event.dataTransfer.items.length != 0){
						var videoObj = this;
						var inspectItem = event.dataTransfer.items[0];
						for(var i=0; i<event.dataTransfer.items.length; i++){
							if(event.dataTransfer.items[i].type == 'text/html'){
								inspectItem = event.dataTransfer.items[i];
								break;
							}
						}				
						inspectItem.getAsString(function(res){
							try{
								res = res.slice(res.indexOf("<img"));	
								res = res.slice(res.indexOf("src"));
								res = res.slice(res.indexOf("\"")+1);
								res = res.substr(0,res.indexOf("\""));
								setVDSrcAndAdjust(videoObj,res,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);						
								//fileUploadHandler(files);
								document.getElementById('VideoURL').value=res;
							}
							catch (e){
								return;
							}
						});				
					}
				}
			}
			event.preventDefault && event.preventDefault();
			
			return false;
		};

		var soundObj = document.getElementById('mainSoundObj');
		soundObj.style.top="328px";
		soundObj.style.width="600px";
		var soundPictureObj = document.getElementById('soundPictureObj');
		/*videoObj.onclick = function () { 
			var event = new Event('click');				
			var fileInputBtn = document.getElementsByName('contentsFile');				
			fileInputBtn[0].dispatchEvent(event);
			return false; 
		};*/
		soundObj.ontouch = function () { this.className = 'hover'; return false; };
		soundObj.ondragover = function () { this.className = 'hover'; return false; };
		soundObj.ondragend = function () { this.className = ''; return false; };
		soundObj.ondrop = function (event) {
			if(!this.isClickable && this.isClickable != undefined)
				return;
			var srcFromADList = event.dataTransfer.getData("srcFromADList");
			if(srcFromADList != null && srcFromADList != undefined && srcFromADList != ""){
				setSNDSrcAndAdjust(this,this.previousSibling,srcFromADList,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
				document.getElementById('SoundURL').value=srcFromADList;
				return;
			}
			if(event.dataTransfer.files.length != 0){
				var files = event.dataTransfer.files;
				var updateElementInfo = {mainElemId : "mainSoundObj",
										urlElemId : "SoundURL",
										progressElemId : "SoundUploadProgress"
										}
				console.log(files);
				//setSNDSrcAndAdjust(this,this.previousSibling,files[0],CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);			
				fileUploadHandler(files,updateElementInfo);				
			}
			else{
				var src = event.dataTransfer.getData("src");
				if(src!=""){
					var soundObj = this;
					if(soundObj.nextElementSibling == document.getElementById('mainSoundObj')){
						soundObj = soundObj.nextElementSibling;
					}
					setSNDSrcAndAdjust(soundObj,soundObj.previousElementSibling,src,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);						
					//fileUploadHandler(files);
					document.getElementById('SoundURL').value=src;
				}
				/*if(event.dataTransfer.items){				
					if(event.dataTransfer.items.length != 0){
						var soundObj = this;
						var inspectItem = event.dataTransfer.items[0];
						for(var i=0; i<event.dataTransfer.items.length; i++){
							if(event.dataTransfer.items[i].type == 'text/html'){
								inspectItem = event.dataTransfer.items[i];
								break;
							}
						}				
						inspectItem.getAsString(function(res){
							try{
								res = res.slice(res.indexOf("<img"));	
								res = res.slice(res.indexOf("src"));
								res = res.slice(res.indexOf("\"")+1);
								res = res.substr(0,res.indexOf("\""));
								setSNDSrcAndAdjust(soundObj,soundObj.previousSibling,res,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);						
								//fileUploadHandler(files);
								document.getElementById('SoundURL').value=res;
							}
							catch (e){
								return;
							}
						});				
					}
				}*/
			}
			event.preventDefault && event.preventDefault();
			
			return false;
		};
		soundPictureObj.ontouch = soundObj.ontouch;
		soundPictureObj.ondragover = soundObj.ondragover;
		soundPictureObj.ondragend = soundObj.ondragend;
		soundPictureObj.ondrop = soundObj.ondrop;		
		
		function setSndDragData(event){
			var elem = event.target;
			var src = elem.nextElementSibling.nextElementSibling.src;
			event.dataTransfer.setData("src",src);
		}
	
		function fileUploadHandler(files,updateElementInfo){				
			var formData = new FormData();
			for (var i = 0; i < files.length; i++) {
				formData.append('file', files[i]);
			}
			formData.append('UI', ContentsModule.Interface.Val_UI);
			formData.append('CT', ContentsModule.Interface.Val_CT);
			
			var mainElem = document.getElementById(updateElementInfo.mainElemId);
			var urlElem = document.getElementById(updateElementInfo.urlElemId);
			var progressElem = document.getElementById(updateElementInfo.progressElemId);

			var xhr = new XMLHttpRequest();
			xhr.open('POST', "http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_PORT+"/upload",true);				
			xhr.upload.onprogress = function (event) {
				mainElem.isClickable = false;
				if (event.lengthComputable) {
					var complete = (event.loaded / event.total * 100 | 0);				
					progressElem.innerHTML = complete + "%";
					
					var left = mainElem.offsetWidth/2 - progressElem.offsetWidth/2;
					if(ContentsModule.Interface.Val_CT != CONTENTS_TYPE_ENUM.Sound)
						var top = mainElem.offsetHeight/2 + progressElem.offsetHeight/2;
					else
						var top = mainElem.previousElementSibling.offsetHeight/2 + progressElem.offsetHeight/2;
					
					progressElem.style.left = left+"px";
					progressElem.style.top = top+"px";
					if(ContentsModule.Interface.Val_CT != CONTENTS_TYPE_ENUM.Sound)
						mainElem.style.opacity = 0.5;
					else
						mainElem.previousElementSibling.style.opacity = 0.5;
					urlElem.value = "Uploading...";
					
					if(complete == 100){
						if(ContentsModule.Interface.Val_CT != CONTENTS_TYPE_ENUM.Sound){
							mainElem.style.opacity = 1.0;								
						}
						else{
							mainElem.previousElementSibling.style.opacity = 1.0;						
						}
						progressElem.innerHTML = "";							
					}
				}
			};

			xhr.onload = function () {
				mainElem.isClickable = true;
				if (xhr.status === 200) {						
					urlElem.value = this.responseText;					
					mainElem.src = this.responseText;
					
					if(ContentsModule.Interface.Val_CT == CONTENTS_TYPE_ENUM.Sound 
						|| ContentsModule.Interface.Val_CT == CONTENTS_TYPE_ENUM.Movie)
						mainElem.play();
					
					if(ContentsModule.Interface.Val_CT == CONTENTS_TYPE_ENUM.Sound){
						setSNDSrcAndAdjust(mainElem,mainElem.previousElementSibling,mainElem.src,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
						/*ID3.loadTags(mainElem.src, function() {
							var tags = ID3.getAllTags(mainElem.src);
							
							var image = tags.picture;
							if (image) {
								var base64String = "";
								for (var i = 0; i < image.data.length; i++) {
									base64String += String.fromCharCode(image.data[i]);
								}
								var base64 = "data:" + image.format + ";base64," +
									window.btoa(base64String);
									mainElem.previousElementSibling.setAttribute('src',base64);
							} 
							else {
								mainElem.previousElementSibling.style.display = "none";
							}
							mainElem.previousElementSibling.onload = function(){
								var nh = mainElem.previousElementSibling.naturalHeight;
								var nw = mainElem.previousElementSibling.naturalWidth;
								
								var resultWidth = (CONTENTS_RECEIVER_MAX_HEIGHT_PX*nw/nh);
								var resultHeight = CONTENTS_RECEIVER_MAX_HEIGHT_PX;
								
								if(resultWidth > CONTENTS_RECEIVER_MAX_WIDTH_PX){
									resultWidth = CONTENTS_RECEIVER_MAX_WIDTH_PX;
									resultHeight = (CONTENTS_RECEIVER_MAX_WIDTH_PX*nh/nw);
								}
							
								mainElem.previousElementSibling.style.width = resultWidth+"px";
								mainElem.previousElementSibling.style.height = resultHeight+'px';
								mainElem.previousElementSibling.parentElement.style.height = (resultHeight+32)+'px';						
								mainElem.style.top = (resultHeight+28)+'px';
								mainElem.style.width = resultWidth+"px";

								adjustDummyDivPos(document.getElementById(CONTENTS_TYPE_ENUM.Sound));
							}
						},{tags: ["title","artist","album","picture"]});	*/	
					}
					
				} else {
					console.log('Something went terribly wrong...');
				}
			};
			xhr.send(formData);
		}
		function loadImageUrlOn(textObj){
			var imageThumbNailObj = document.getElementById('ThumbNailImg');
			setImgSrcAndAdjust(imageThumbNailObj,textObj.value,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
		}
		function loadVDUrlOn(textObj){
			var vdObj = document.getElementById('mainVideoObj');
			setVDSrcAndAdjust(vdObj,textObj.value,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
		}
		function loadSNDUrlOn(textObj){
			var sndObj = document.getElementById('mainSoundObj');
			setSNDSrcAndAdjust(sndObj,sndObj.previousSibling,textObj.value,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
		}
		function loadWebUrlOn(textObj){
		
		//<img id="WebPreviewImgObj"  style="position:absolute;width:600px height:600px;" ontouchstart='visitWebPage(this)' onclick='visitWebPage(this)'> </img>		
		
			var WebPreviewContainer = document.getElementById('WebPreviewContainer');
			
			while (WebPreviewContainer.firstChild) {
				WebPreviewContainer.removeChild(WebPreviewContainer.firstChild);
			}

			//Progress effect
			var num = 7;
			var ang = 360/num;
			var rad = num*5;
			
			var progressContainer = document.createElement('div');
			progressContainer.id = "hold";
			WebPreviewContainer.appendChild(progressContainer);
			
			for(var i=0; i<num; i++){
				var button = document.createElement('div');
				button.className = "dot"+i+" dot";
				button.style.top = rad*Math.cos(ang*i*Math.PI/180)-10+"px";
				button.style.left = rad*Math.sin(ang*i*Math.PI/180)-10+"px";
				button.style.backgroundColor = "hsla("+ang*i+", 50%, 50%, 1)";

				button.style.webkitAnimation = 
				  "osc 2s ease-in-out infinite "+i/(num/2)+"s, rainbow 8s infinite linear "+i/(num/2)+"s";
				button.style.animation = 
				  "osc 2s ease-in-out infinite "+i/(num/2)+"s, rainbow 8s infinite linear "+i/(num/2)+"s";				

				progressContainer.appendChild(button);			
			}
			
			var srcString = //"http://"+CONTENTS_SERVER_ADDR+":"+CONTENTS_SERVER_PORT+"/webpreview?"
						"http://127.0.0.1:"+CONTENTS_SERVER_PORT+"/webpreview?"
						+REQ_PARAM_ENUM.CT+"="+CONTENTS_TYPE_ENUM.WebPreview+"&"
						+REQ_PARAM_ENUM.WP_URL+"="+textObj.value+"&"
						+REQ_PARAM_ENUM.WP_RESOLUTION+"=1280X840&";
						
		//	WebSelector.innerHTML = "<img id='WebPreviewImgObj' src='"+srcString+"' ontouchstart='visitWebPage(this)' onclick='visitWebPage(this)'> </img>"
									
									
			
			var webPreviewImgObj = document.createElement('img');
			webPreviewImgObj.src = srcString;
		//	webPreviewImgObj.ontouchstart = visitWebPage;
		//	webPreviewImgObj.onclick = visitWebPage;
			//var dummyIframe = document.getElementById('WebPreviewDummyIframe');

			webPreviewImgObj.onload = function(){
				var maxWidth = CONTENTS_RECEIVER_MAX_WIDTH_PX-17.5;
				var maxHeight = CONTENTS_RECEIVER_MAX_HEIGHT_PX;
				var nh = webPreviewImgObj.naturalHeight;
				var nw = webPreviewImgObj.naturalWidth;
				
				var resultWidth = (maxHeight*nw/nh);
				var resultHeight = maxHeight;
				
				if(resultWidth > maxWidth){
					resultWidth = maxWidth;
					resultHeight = (maxWidth*nh/nw);
				}
			
				webPreviewImgObj.style.width = maxWidth+"px";
				//webPreviewImgObj.parentElement.style.overflow="hidden";
				//webPreviewImgObj.parentElement.style.overflow="auto";
				WebPreviewContainer.removeChild(WebPreviewContainer.firstChild);
				WebPreviewContainer.appendChild(webPreviewImgObj);
				WebPreviewContainer.style.width = '600';
				WebPreviewContainer.style.height = '717.5';
				
				//webPreviewImgObj.style.height = resultHeight+'px';
				//webPreviewImgObj.parentElement.style.height = (resultHeight+10)+'px';						

				//adjustDummyDivPos(document.getElementById(CONTENTS_TYPE_ENUM.Image));
			}
			/*var iframeDocument = dummyIframe.contentDocument || dummyIframe.contentWindow.document;
			html2canvas(iframeDocument, {
				onrendered: function(canvas) {
					webObj.removeChild(webObj.firstChild);
					webObj.appendChild(canvas);
				},
				height : 347.5,
				widht : 600
			});*/
			//setSNDSrcAndAdjust(sndObj,sndObj.previousSibling,textObj.value,CONTENTS_RECEIVER_MAX_WIDTH_PX,CONTENTS_RECEIVER_MAX_HEIGHT_PX);
		}
		function setImgSrcAndAdjust(imgObj,srcURL,maxWidth,maxHeight){
			imgObj.src = srcURL;
			
			imgObj.onload = function(){
				var nh = imgObj.naturalHeight;
				var nw = imgObj.naturalWidth;
				
				var resultWidth = (maxHeight*nw/nh);
				var resultHeight = maxHeight;
				
				if(resultWidth > maxWidth){
					resultWidth = maxWidth;
					resultHeight = (maxWidth*nh/nw);
				}
			
				imgObj.style.width = resultWidth+"px";
				imgObj.style.height = resultHeight+'px';
				imgObj.parentElement.style.height = (resultHeight+10)+'px';						

				adjustDummyDivPos(document.getElementById(CONTENTS_TYPE_ENUM.Image));
			}
		}
		
		function setVDSrcAndAdjust(vdObj,srcURL,maxWidth,maxHeight){
			vdObj.adaptiveVdObj.onVDLoad = function(){
				var nh;
				var nw;
				
				if(vdObj.naturalHeight != undefined && vdObj.naturalHeight != null){
					nh = vdObj.naturalHeight;
					nw = vdObj.naturalWidth;
				}
				else{
					nh = vdObj.adaptiveVdObj.getPlayerHeight();
					nw = vdObj.adaptiveVdObj.getPlayerWidth();
				}
				
				var resultWidth = (maxHeight*nw/nh);
				var resultHeight = maxHeight;
				
				if(resultWidth > maxWidth){
					resultWidth = maxWidth;
					resultHeight = (maxWidth*nh/nw);
				}
				
				/*if(resultHeight > maxHeight){
					
					resultWidth = (maxHeight*resultWidth/resultHeight);	
					resultHeight = maxHeight;					
				}*/
			
				vdObj.adaptiveVdObj.setPlayerHeight(resultHeight);
				vdObj.adaptiveVdObj.setPlayerWidth(resultWidth);
				vdObj.parentElement.style.height = (resultHeight+10)+'px';							

				adjustDummyDivPos(document.getElementById(CONTENTS_TYPE_ENUM.Movie));
			}			
			vdObj.adaptiveVdObj.setURL(srcURL);
		}
		function setSNDSrcAndAdjust(sndObj,sndPictureObj,srcURL,maxWidth,maxHeight){
			sndObj.src = srcURL;			
			ID3.loadTags(sndObj.src, function() {
				var tags = ID3.getAllTags(sndObj.src);
				
				var image = tags.picture;
				if (image) {
					var base64String = "";
					for (var i = 0; i < image.data.length; i++) {
						base64String += String.fromCharCode(image.data[i]);
					}
					var base64 = "data:" + image.format + ";base64," +
						window.btoa(base64String);
						sndPictureObj.setAttribute('src',base64);
				} 
				else {
					sndPictureObj.style.display = "none";
				}
				sndPictureObj.onload = function(){
					var nh = sndPictureObj.naturalHeight;
					var nw = sndPictureObj.naturalWidth;
					
					var resultWidth = (CONTENTS_RECEIVER_MAX_HEIGHT_PX*nw/nh);
					var resultHeight = CONTENTS_RECEIVER_MAX_HEIGHT_PX;
					
					if(resultWidth > CONTENTS_RECEIVER_MAX_WIDTH_PX){
						resultWidth = CONTENTS_RECEIVER_MAX_WIDTH_PX;
						resultHeight = (CONTENTS_RECEIVER_MAX_WIDTH_PX*nh/nw);
					}
				
					sndPictureObj.style.width = resultWidth+"px";
					sndPictureObj.style.height = resultHeight+'px';
					sndPictureObj.parentElement.style.height = (resultHeight+32)+'px';						
					sndObj.style.top = (resultHeight+28)+'px';
					sndObj.style.width = resultWidth+"px";
					
					sndObj.play();

					adjustDummyDivPos(document.getElementById(CONTENTS_TYPE_ENUM.Sound));
				}
			},{tags: ["title","artist","album","picture"]});	
		}
		function playOrStopAudio(target)
		{
			var audioObj = target.nextSibling.nextSibling;
			if(audioObj.paused)
				audioObj.play();
			else
				audioObj.pause();
		}
		
		function adjustDummyDivPos(managerElem)
		{		
			var setHeight = ((managerElem.getElementsByClassName('fixedDiv')[0]).clientHeight+10);
			managerElem.getElementsByClassName('dummyDiv')[0].style.height = setHeight;
		}
		
		function videoPopUp(elementObj){
			if(!elementObj.isClickable && elementObj.isClickable != undefined)
				return;
			var vdmodalObj = $('#openVDModal');
			
			//location.href='#openVDModal';
			//vdmodalObj[0].children[0].style.zIndex = "9999";
			if(vdmodalObj[0].isPopped == undefined || vdmodalObj[0].isPopped == false){				
				vdmodalObj.toggleClass('fadeout_anim');
				vdmodalObj.toggleClass('fadein_anim');
			}
			if(elementObj.src == popupVDPlayer.getURL() && vdmodalObj[0].isPopped)
				return;
			
			vdmodalObj[0].isPopped = true;
		//	var videoObjsParent = document.getElementById('videoObjs');
			var url = elementObj.src;
			document.getElementById('vdName').innerHTML = url;
			popupVDPlayer.setPlayerHeight(350);
			popupVDPlayer.setPlayerWidth(600);
			popupVDPlayer.setURL(url);
			/*var html5VDObj = document.getElementById('popUpVideoObj');
			var youtubeVDObj = document.getElementById('popUpYTBVideoObj');
			if(url.startsWith("https://youtu.be")){
				var youtubeId = url.substring(url.lastIndexOf("/")+1);
				var youtubeSrc = "https://www.youtube.com/embed/"+youtubeId;
				youtubeVDObj.src = youtubeSrc;
				document.getElementById('vdName').innerHTML = youtubeSrc;
			
				html5VDObj.style.display = "none";
			}
			else{
				html5VDObj.src = elementObj.src;
				html5VDObj.play();
				document.getElementById('vdName').innerHTML = elementObj.src;
				
				youtubeVDObj.style.display = "none";				
			}*/
		}
		function videoPopUpShadow(elementObj){
			if(!elementObj.isClickable && elementObj.isClickable != undefined)
				return;
			//location.href='#openVDModal';
			var vdmodalObj = $('#openVDModal');
			vdmodalObj[0].isPopped = false;			
			vdmodalObj.toggleClass('fadeout_anim');
			vdmodalObj.toggleClass('fadein_anim');
			//vdmodalObj[0].style.zIndex = "1";
		//	var videoObjsParent = document.getElementById('videoObjs');
			popupVDPlayer.stopPlay();
			/*var html5VDObj = document.getElementById('popUpVideoObj');
			var youtubeVDObj = document.getElementById('popUpYTBVideoObj');
			if(url.startsWith("https://youtu.be")){
				var youtubeId = url.substring(url.lastIndexOf("/")+1);
				var youtubeSrc = "https://www.youtube.com/embed/"+youtubeId;
				youtubeVDObj.src = youtubeSrc;
				document.getElementById('vdName').innerHTML = youtubeSrc;
			
				html5VDObj.style.display = "none";
			}
			else{
				html5VDObj.src = elementObj.src;
				html5VDObj.play();
				document.getElementById('vdName').innerHTML = elementObj.src;
				
				youtubeVDObj.style.display = "none";				
			}*/
		}
		function onVideoDragStart(event){
			event.dataTransfer.setData("srcFromVDList", event.target.src);
		}
		
		function onShowTextExtend(event){
			var textExtendElem = document.getElementById('textShowingDiv');
			textExtendElem.style.display = "inline";
			textExtendElem.innerHTML = event.target.innerHTML;
			var X;
			var Y;
			
			if(event.clientX == undefined){
				event.clientX = event.touches.item(0).clientX.toFixed(0);
				event.clientY = event.touches.item(0).clientY.toFixed(0);
			}
			
			textExtendElem.style.top = event.clientY +10;//- textExtendElem.offsetHeight/2;
			textExtendElem.style.left = event.clientX +10;//- textExtendElem.offsetWidth/2;				
		}
		
		function onMoveTextExtend(event){
			var textExtendElem = document.getElementById('textShowingDiv');
			
			if(event.clientX == undefined){
				event.clientX = event.touches.item(0).clientX.toFixed(0);
				event.clientY = event.touches.item(0).clientY.toFixed(0);
			}
			
			textExtendElem.style.top = event.clientY +10;//- textExtendElem.offsetHeight/2;
			textExtendElem.style.left = event.clientX +10;//- textExtendElem.offsetWidth/2;	
		}
		
		function onHideTextExtend(){
			var textExtendElem = document.getElementById('textShowingDiv');
			textExtendElem.style.display = "none";			
		}
		
	</script>		
</body>
</html>